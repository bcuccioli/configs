# Redirect port 53 traffic to server.
iptables -t nat -A PREROUTING -p tcp --dport 53 -j DNAT --to 192.168.0.2:53
iptables -t nat -A PREROUTING -p udp --dport 53 -j DNAT --to 192.168.0.2:53
iptables -t nat -A POSTROUTING -j MASQUERADE
ip6tables -t nat -A PREROUTING -p tcp --dport 53 -j DNAT --to [fe80::604f:d3df:c4fe:31d4]:53
ip6tables -t nat -A PREROUTING -p udp --dport 53 -j DNAT --to [fe80::604f:d3df:c4fe:31d4]:53
ip6tables -t nat -A POSTROUTING -j MASQUERADE

# Disallow outgoing port 53 traffic.
iptables -I FORWARD -p tcp --dport 53 -j REJECT
iptables -I FORWARD -p udp --dport 53 -j REJECT
ip6tables -I FORWARD -p tcp --dport 53 -j REJECT
ip6tables -I FORWARD -p udp --dport 53 -j REJECT

# But do allow port 53 traffic to DNS server.
iptables -I FORWARD -p tcp --dport 53 -d 192.168.0.2 -j ACCEPT
iptables -I FORWARD -p udp --dport 53 -d 192.168.0.2 -j ACCEPT
ip6tables -I FORWARD -p tcp --dport 53 -d fe80::604f:d3df:c4fe:31d4 -j ACCEPT
ip6tables -I FORWARD -p udp --dport 53 -d fe80::604f:d3df:c4fe:31d4 -j ACCEPT

# Also allow pub to talk to server over port 53.
iptables -I FORWARD -i br-pub -p tcp --dport 53 -d 192.168.0.2 -j ACCEPT
iptables -I FORWARD -i br-pub -p udp --dport 53 -d 192.168.0.2 -j ACCEPT
ip6tables -I FORWARD -i br-pub -p tcp --dport 53 -d fe80::604f:d3df:c4fe:31d4 -j ACCEPT
ip6tables -I FORWARD -i br-pub -p udp --dport 53 -d fe80::604f:d3df:c4fe:31d4 -j ACCEPT

# Allow ping from trusted VLAN.
iptables -I FORWARD -i br-priv -p icmp -j ACCEPT
ip6tables -I FORWARD -i br-priv -p icmp -j ACCEPT

# Allow SSH from trusted VLAN.
iptables -I FORWARD -i br-priv -p tcp --dport 22 -j ACCEPT
